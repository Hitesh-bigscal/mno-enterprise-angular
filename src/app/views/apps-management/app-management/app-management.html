<div class='row show-header top-buffer-4'>
  <div class='col-xs-12'>
    <a ui-sref="home.apps-management" class='text-muted'>
      <i class='fa fa-chevron-left'></i> Back to list
    </a>
  </div>
</div>

<mno-loader ng-show="vm.isLoading" class='top-buffer-4'></mno-loader>
<div class='row dashboard-app-management' ng-if="!vm.isLoading">
  <div class='col-xs-12'>
    <div class='col-xs-offset-1'>
      <h2>
        <img class='app-logo' ng-src="{{vm.app.logo}}">
        <label class='margin-left-20'>{{vm.app.app_name}}</label>
      </h2>
    </div>

    <uib-tabset active='active'>
      <uib-tab index='0'>
        <div uib-tab-heading>App info</div>
        <div class='row'>
          <div class='col-xs-12'>
            <div>
              <h3>Description</h3>
              <p>
                {{vm.app.name}}: {{vm.app.tiny_description}}
              </p>
              <p>
                <a ui-sref="home.marketplace.app({appId: vm.app.app_nid})">
                  View details of product on the marketplace
                </a>
              </p>
            </div>

            <div>
              <h3>Getting Started</h3>
              <p ng-bind-html="vm.app.getting_started"></p>
            </div>

            <div>
              <h3>Support</h3>
              <div>
                <a ng-href="{{ vm.app.support_url }}" target='_blank'>
                  {{vm.app.app_name}} Helpdesk
                </a>
              </div>
              <div>
                <!-- TODO: Confirm Knowledge base URL -->
                <a href='https://maestrano.atlassian.net/wiki/x/NIFpAQ' target='_blank'>
                  Maestrano knowledge base
                </a>
              </div>
            </div>

            <div>
              <h3>Technical details</h3>
              <p>
                These details would be useful when communicating with support
              </p>
              <div>
                <label>Organization id:</label>
                <span>{{vm.organization.uid}}</span>
              </div>
              <div>
                <label>Group id (uid):</label>
                <span>{{vm.app.uid}}</span>
              </div>
            </div>
          </div>
        </div>
      </uib-tab>
      <uib-tab index='1' disable="!vm.dataSharingEnabled">
        <div uib-tab-heading>
          Connection status
        </div>

        <div class='row'>
          <div class='col-xs-12'>
            <div>
              <label>Connection Status</label>
              <span>{{vm.dataSharingStatus()}}</span>
            </div>
            <!-- TODO: Add logic to add message "This application does not
                       provide a connection status" when data sharing is not
                       available -->
            <div>
              <label>Last sync:</label>
              <!-- TODO: Decide between "Never" and "Sync in progress" -->
              <span>{{vm.app.last_sync_at || 'Sync In progress'}}</span>
            </div>
            <div>
              <!-- TODO: Add conditions to manage when this button
                         should be shown(APPINT-1044) -->
              <button>Access Add-on setting</button>
            </div>
          </div>
        </div>
      </uib-tab>
      <uib-tab index='2'>
        <div uib-tab-heading>
          Update Subscription
        </div>

        <div class='row'>
          <div class='col-xs-12'>
            <div class="table-cell">
              <div class="row th-row hidden-xs">
                <div class="col-xs-10 col-xs-offset-2">
                  <div class="cell col-sm-3">{{ 'mno_enterprise.templates.dashboard.provisioning.order.name' | translate }}</div>
                  <div class="cell col-sm-5">{{ 'mno_enterprise.templates.dashboard.provisioning.order.description' | translate }}</div>
                  <div class="cell col-sm-3">{{ 'mno_enterprise.templates.dashboard.provisioning.order.price' | translate }}</div>
                </div>
              </div>
              <div>Current Subscription</div>

              <div class="row td-row" ng-if="vm.subscription.product.pricing_plans.length === 0">
                <div class="cell col-md-12 text-center" translate>
                  {{ 'mno_enterprise.templates.dashboard.provisioning.order.no_pricing_found' | translate }}
                </div>
              </div>

              <div class="row td-row" ng-repeat="pricingPlan in vm.subscription.product.pricing_plans" ng-click="vm.select_plan(pricingPlan)">
                <div class="cell radio-selector col-xs-2">
                  <input type="radio" name="optradio" ng-model="vm.subscription.product_pricing.id" ng-value="pricingPlan.id" required>
                </div>

                <div class="col-xs-10">
                  <div class="cell col-sm-3">
                    <span class="cell-label visible-xs-inline">
                      {{ 'mno_enterprise.templates.dashboard.provisioning.order.name' | translate }}:
                    </span>
                    {{ pricingPlan.name }}
                  </div>

                  <div class="cell col-sm-5">
                    <span class="cell-label visible-xs-inline">
                      {{ 'mno_enterprise.templates.dashboard.provisioning.order.description' | translate }}:
                    </span>
                    {{ pricingPlan.description }}
                  </div>

                  <div class="cell col-sm-3">
                    <span class="cell-label visible-xs-inline">
                      {{ 'mno_enterprise.templates.dashboard.provisioning.order.price' | translate }}:
                    </span>
                    <span ng-if="vm.pricedPlan(pricingPlan)" ng-repeat="price in pricingPlan.prices | filterBy: ['currency']: vm.orgCurrency" class="badge">
                      {{ price.currency }} {{ price.price_cents / 100 }}
                    </span>
                    <span ng-show="pricingPlan.pricing_type == 'recurring'">
                      / {{ pricingPlan.per_unit }} / {{ pricingPlan.per_duration }}
                    </span>
                    <span ng-show="pricingPlan.pricing_type == 'payg'">
                      {{ 'mno_enterprise.templates.dashboard.provisioning.order.pricing_type.payg' | translate }}
                    </span>
                    <span ng-show="pricingPlan.pricing_type == 'free'">
                      {{ 'mno_enterprise.templates.dashboard.provisioning.order.pricing_type.free' | translate }}
                    </span>
                  </div>
                </div>
              </div>

              <div ng-show="vm.subscription.product_pricing.license_based">
                <div class="row">
                  <div class="col-xs-10">
                    <label>{{ 'mno_enterprise.templates.dashboard.provisioning.order.licenses' | translate }}:
                      <input type="number" name="input" ng-model="vm.subscription.max_licenses" min="1" ng-required="vm.subscription.product_pricing.license_based">
                    </label>
                  </div>
                </div>

                <div class="row">
                  <div class="col-xs-10">
                    <label>{{ 'mno_enterprise.templates.dashboard.provisioning.order.total' | translate }}:
                      <span ng-hide="vm.subscription.product_pricing.pricing_type == 'payg'" ng-repeat="price in vm.subscription.product_pricing.prices | filterBy: ['currency']: vm.orgCurrency" class="badge">
                        {{ price.currency }} {{ price.price_cents / 100 * vm.subscription.max_licenses | number:2 }}
                      </span>
                      <span ng-show="vm.subscription.product_pricing.pricing_type == 'recurring'">
                        / {{ vm.subscription.product_pricing.per_unit }} / {{ vm.subscription.product_pricing.per_duration }}
                      </span>
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </uib-tab>
      <uib-tab index='3'>
        <div uib-tab-heading>
          Order Histroy
        </div>
      </uib-tab>
    </uib-tabset>
  </div>
</div>
